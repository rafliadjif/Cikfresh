<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Produk — CIKFRESH</title>
    <meta name="description" content="Lihat semua sayur segar yang tersedia di CIKFRESH." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #2e8b57;
            --accent: #f2a541;
            --muted: #6b7280;
            --bg: #F8F9FA;
            --card-bg: #FFFFFF;
            --border-color: #E5E7EB;
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Inter', system-ui, Arial, sans-serif; background: var(--bg); color: #0f172a; }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        /* Header */
        header { background: var(--card-bg); box-shadow: 0 2px 6px rgba(0,0,0,.06); position: sticky; top: 0; z-index: 50; }
        .nav-container { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
        .brand { display: flex; align-items: center; gap: 12px; }
        .logo { width: 44px; height: 44px; background: linear-gradient(135deg, var(--green), #38b000); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; }
        .brand-name { font-weight: 700; }
        .brand-tagline { font-size: 13px; color: var(--muted); }
        nav a { margin-left: 12px; color: var(--muted); text-decoration: none; font-weight: 500; }
        nav a:hover { color: var(--green); }
        /* Grid & Card */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 6px 18px rgba(16,24,40,.06); display: flex; flex-direction: column; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 24px rgba(16,24,40,.1); }
        .card-img { height: 160px; width: 100%; object-fit: cover; }
        .card-body { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-title { font-weight: 700; }
        .card-unit { font-size: 14px; color: var(--muted); }
        .card-desc { font-size: 13px; color: var(--muted); margin: 10px 0; flex-grow: 1; }
        .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .price { font-weight: 700; font-size: 1.1em; }
        .btn { background: var(--green); color: white; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: 500; }
        /* Cart */
        .cart { position: fixed; right: 18px; bottom: 18px; background: linear-gradient(180deg, #fff, #f8fff8); padding: 16px; border-radius: 12px; box-shadow: 0 8px 20px rgba(2,6,23,.1); width: 340px; max-width: 90%; z-index: 100; }
        .cart h3 { margin: 0 0 12px 0; }
        .cart-list { max-height: 260px; overflow-y: auto; margin-bottom: 12px; }
        .cart-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-color); align-items: center; }
        .cart-item-info { flex-grow: 1; }
        .cart-item-title { font-weight: 700; }
        .cart-item-price { font-size: 13px; color: var(--muted); }
        .cart-item-actions { display: flex; align-items: center; gap: 8px; }
        .qty-btn { width: 24px; height: 24px; border-radius: 50%; border: 1px solid var(--border-color); background: #fff; cursor: pointer; }
        .remove-btn { border: none; background: transparent; cursor: pointer; padding: 0; }
        .cart-total-line { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
        #cartTotal { font-weight: 700; font-size: 1.2em; }
        /* Checkout Modal */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(2,6,23,.35); align-items: center; justify-content: center; padding: 20px; z-index: 200; }
        .modal-content { background: white; border-radius: 12px; padding: 24px; max-width: 480px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .modal-content h3 { margin: 0 0 16px 0; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        form input, form textarea, form select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); margin-top: 8px; font-family: inherit; }
        .form-group { margin-bottom: 12px; }
        .form-footer { display: flex; gap: 8px; margin-top: 16px; justify-content: flex-end; }
        .btn-secondary { padding: 10px 16px; border-radius: 8px; border: 1px solid var(--border-color); background: #fff; cursor: pointer; }
        footer { padding: 40px 0; color: var(--muted); text-align: center; }
        /* Style untuk Testimoni (Tidak ada di halaman ini, tapi CSS-nya tetap ada) */
        .testimoni-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 16px; }
        .testimoni-card { background: white; border-radius: 12px; padding: 8px; box-shadow: 0 6px 18px rgba(16,24,40,.08); overflow: hidden; }
        .testimoni-card img { display: block; width: 100%; height: auto; border-radius: 8px; }
    </style>
</head>
<body>
    <template id="productCardTemplate">
        <div class="card">
            <img class="card-img" src="" alt="">
            <div class="card-body">
                <div style="display:flex; justify-content:space-between; align-items:start;">
                    <div class="card-title"></div>
                    <div class="card-unit"></div>
                </div>
                <p class="card-desc"></p>
                <div class="card-footer">
                    <div class="price"></div>
                    <button class="btn add-to-cart-btn">Tambah</button>
                </div>
            </div>
        </div>
    </template>
    
    <template id="cartItemTemplate">
        <div class="cart-item">
            <div class="cart-item-info">
                <div class="cart-item-title"></div>
                <div class="cart-item-price"></div>
            </div>
            <div class="cart-item-actions">
                <button class="qty-btn" onclick="">-</button>
                <span class="qty">1</span>
                <button class="qty-btn" onclick="">+</button>
                <button class="remove-btn" onclick="" title="Hapus item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#c33"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                </button>
            </div>
        </div>
    </template>

    <header>
        <div class="container nav-container">
            <div class="brand">
                <div class="logo">CF</div>
                <div>
                    <div class="brand-name">CIKFRESH</div>
                    <div class="brand-tagline">Sayur lokal, Kirim cepat</div>
                </div>
            </div>
            <nav>
                <a href="index.html">Home</a>
                <a href="produk.html">Produk</a>
                <a href="testimoni.html">Testimoni</a>
                <a href="tentang.html">Tentang</a>
                <a href="kontak.html">Kontak</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="produk" style="padding-top: 24px;">
            <h2>Produk Kami</h2>
            <div class="grid" id="productGrid"></div>
        </section>
        </main>

    <div class="cart" id="cartBox">
        <h3>Keranjang</h3>
        <div class="cart-list" id="cartList">
            <div class="muted" style="font-size: 14px;">Keranjang kosong</div>
        </div>
        <div class="cart-total-line">
            <div>
                <div style="font-size: 14px; color: var(--muted);">Total</div>
                <div id="cartTotal">Rp 0</div>
            </div>
            <button class="btn" id="checkoutBtn" onclick="openCheckout()" disabled>Checkout</button>
        </div>
    </div>

    <div id="checkoutModal" class="modal-overlay">
        <div class="modal-content">
            <h3>Buat Pesanan</h3>
            <form id="orderForm">
                <div class="form-grid">
                    <div class="form-group"><input name="name" placeholder="Nama" required /></div>
                    <div class="form-group"><input name="phone" placeholder="No. HP (WA)" required /></div>
                </div>
                <div class="form-group"><textarea name="address" placeholder="Alamat lengkap (termasuk kec/kab)" rows="3" required></textarea></div>
                <div class="form-group" style="display:flex; align-items:center; gap:8px;">
                    <label style="color: var(--muted);">Metode Bayar</label>
                    <select name="payment">
                        <option value="cod">Bayar di tempat (COD)</option>
                        <option value="transfer">Transfer / e-wallet</option>
                    </select>
                </div>
                <div class="form-footer">
                    <button type="button" onclick="closeCheckout()" class="btn-secondary">Batal</button>
                    <button class="btn" type="submit">Kirim Pesanan via WhatsApp</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="container">
        © CIKFRESH — Prototype Tugas
    </footer>

    <script>
    // --- GANTI NOMOR WHATSAPP DI SINI ---
    const WHATSAPP_NUMBER = '62895365249519'; // Ganti dengan nomor WA tujuan (diawali 62)

    // --- DAFTAR PRODUK ---
    const products = [
         {id:1, name:'Terong Ungu', unit:'500 gr', price:10000, desc:'Terong ungu segar ukuran sedang', image: 'images/Terong-Ungu.jpg'},
         {id:2, name:'Jeruk Nipis', unit:'250 gr', price:8000, desc:'Jeruk nipis segar kaya vitamin C', image: 'images/Jeruk-Nipis.jpg'},
         {id:3, name:'Pare', unit:'1 buah', price:7000, desc:'Pare hijau segar untuk tumisan', image: 'images/Pare.jpg'},
         {id:4, name:'Terong Lalap', unit:'250 gr', price:6000, desc:'Terong bulat hijau untuk lalapan', image: 'images/Terong-Lalap.jpg'},
         {id:5, name:'Tomat', unit:'500 gr', price:9000, desc:'Tomat merah segar dan berair', image: 'images/Tomat.jpg'},
         {id:6, name:'Wortel', unit:'500 gr', price:12000, desc:'Wortel impor yang manis & renyah', image: 'images/Wortel.jpg'},
         {id:7, name:'Timun', unit:'500 gr', price:8000, desc:'Timun segar cocok untuk lalapan', image: 'images/Timun.jpg'},
         {id:8, name:'Daun Bawang', unit:'1 ikat', price:5000, desc:'Daun bawang penyedap masakan', image: 'images/Daun-Bawang.jpg'},
         {id:11, name:'Brokoli', unit:'500 gr', price:18000, desc:'Brokoli hijau segar dan padat', image: 'images/Brokoli.jpg'},
         {id:12, name:'Labu Siam', unit:'1 buah', price:6000, desc:'Labu siam segar untuk sayur bening', image: 'images/Labu-Siam.jpg'}
    ];

    // --- LOGIKA APLIKASI ---
    const productGrid = document.getElementById('productGrid');
    const productCardTemplate = document.getElementById('productCardTemplate');
    const cartList = document.getElementById('cartList');
    const cartItemTemplate = document.getElementById('cartItemTemplate');
    const cartTotalEl = document.getElementById('cartTotal');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const checkoutModal = document.getElementById('checkoutModal');
    
    // ============= PERUBAHAN 1: AMBIL KERANJANG DARI LOCALSTORAGE =============
    let cart = JSON.parse(localStorage.getItem('cikfreshCart')) || [];

    // ============= PERUBAHAN 2: FUNGSI BARU UNTUK MENYIMPAN KERANJANG =============
    function saveCart() {
        localStorage.setItem('cikfreshCart', JSON.stringify(cart));
    }

    function renderProducts() {
        // Pengecekan ini penting agar tidak error di halaman lain
        if (!productGrid || !productCardTemplate) return; 

        products.forEach(p => {
            const card = document.importNode(productCardTemplate.content, true);
            card.querySelector('.card-img').src = p.image;
            card.querySelector('.card-img').alt = p.name;
            card.querySelector('.card-title').textContent = p.name;
            card.querySelector('.card-unit').textContent = p.unit;
            card.querySelector('.card-desc').textContent = p.desc;
            card.querySelector('.price').textContent = `Rp ${numberWithCommas(p.price)}`;
            card.querySelector('.add-to-cart-btn').onclick = () => addToCart(p.id);
            productGrid.appendChild(card);
        });
    }

    function renderCart() {
        // Pengecekan ini penting agar tidak error di halaman non-produk
        if (!cartList || !cartItemTemplate) return;

        cartList.innerHTML = '';
        if (cart.length === 0) {
            cartList.innerHTML = '<div class="muted" style="font-size: 14px;">Keranjang kosong</div>';
            
            // ============= PERUBAHAN 3: SIMPAN SAAT KERANJANG KOSONG =============
            saveCart();
            updateCartTotal();
            return;
        }

        cart.forEach(ci => {
            const p = products.find(prod => prod.id === ci.id);
            // Jaga-jaga jika produk tidak ditemukan
            if (!p) {
                cart = cart.filter(item => item.id !== ci.id); // Hapus item aneh dari keranjang
                return;
            }
            const item = document.importNode(cartItemTemplate.content, true);
            item.querySelector('.cart-item-title').textContent = p.name;
            item.querySelector('.cart-item-price').textContent = `Rp ${numberWithCommas(p.price)}`;
            item.querySelector('.qty').textContent = ci.qty;
            const actions = item.querySelector('.cart-item-actions').querySelectorAll('button');
            actions[0].onclick = () => changeQty(p.id, -1);
            actions[1].onclick = () => changeQty(p.id, 1);
            actions[2].onclick = () => removeFromCart(p.id);
            cartList.appendChild(item);
        });

        // ============= PERUBAHAN 4: SIMPAN SETIAP KALI RENDER KERANJANG =============
        saveCart();
        updateCartTotal();
    }

    function addToCart(id) {
        const found = cart.find(ci => ci.id === id);
        if (found) {
            found.qty++;
        } else {
            cart.push({ id, qty: 1 });
        }
        renderCart(); // renderCart() akan otomatis menyimpan
    }

    function removeFromCart(id) {
        cart = cart.filter(c => c.id !== id);
        renderCart(); // renderCart() akan otomatis menyimpan
    }

    function changeQty(id, delta) {
        const item = cart.find(c => c.id === id);
        if (!item) return;
        item.qty += delta;
        if (item.qty < 1) {
            removeFromCart(id); // removeFromCart() akan memanggil renderCart()
        } else {
            renderCart(); // renderCart() akan otomatis menyimpan
        }
    }

    function updateCartTotal() {
        if (!cartTotalEl) return; // Jaga-jaga
        
        const total = cart.reduce((sum, ci) => {
            const product = products.find(p => p.id === ci.id);
            if (!product) return sum; // Jaga-jaga jika produk tidak ada
            return sum + (product.price * ci.qty);
        }, 0);
        cartTotalEl.textContent = `Rp ${numberWithCommas(total)}`;
        if (checkoutBtn) checkoutBtn.disabled = cart.length === 0;
    }

    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Checkout Logic
    function openCheckout() { if (checkoutModal) checkoutModal.style.display = 'flex'; }
    function closeCheckout() { if (checkoutModal) checkoutModal.style.display = 'none'; }

    // Pastikan form order hanya berjalan jika ada
    const orderForm = document.getElementById('orderForm');
    if (orderForm) {
        orderForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const form = new FormData(e.target);
            const total = cart.reduce((s,ci)=>s + products.find(p=>p.id===ci.id).price * ci.qty,0);
            
            let message = `Halo CIKFRESH, saya mau pesan:\n\n`;
            cart.forEach(ci => {
                const p = products.find(prod => prod.id === ci.id);
                message += `- ${p.name} (*${ci.qty}* x ${p.unit})\n`;
            });
            message += `\n*Total: Rp ${numberWithCommas(total)}*\n\n`;
            message += `*Data Penerima:*\n`;
            message += `Nama: ${form.get('name')}\n`;
            message += `No. HP: ${form.get('phone')}\n`;
            message += `Alamat: ${form.get('address')}\n`;
            message += `Pembayaran: ${form.get('payment')}\n\n`;
            message += `Terima kasih!`;

            const whatsappURL = `https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
            
            alert('Pesanan sedang dialihkan ke WhatsApp. Silakan kirim pesan yang sudah disiapkan.');
            
            // ============= PERUBAHAN 5: SIMPAN KERANJANG KOSONG SETELAH CHECKOUT =============
            cart = [];
            saveCart();
            renderCart();
            closeCheckout();
        });
    }

    // Initial Render
    renderProducts();
    renderCart();
</script>
</body>
</html>
